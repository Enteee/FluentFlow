<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

## FluentFlow

FluentFlow is a filter language which lets you easily define 'followed by'-relations in a flow of JavaScript objects. You can either use FluentFlow [from the command line][1] or as a [JavaScript library][2].

[![Travis][4]][3]
[![Coverage Status][6]][5]
[![js-semistandard-style][8]][7]
[#FluentFlow][9]


## Library

### Installation

```shell
$ npm install --save fluentflow 
```

### Usage

```javascript
const ff = require('fluentflow');
const $ = ff.RuleBuilder
const _ = require('lodash');

/**
 * Log all numbers greater than 9000.
 */
const ffm = ff.Matcher(
  $(
    // Start matching after 9000
    (o, p, c, pc, match) => match(o === 9000)
  ).followedBy(
    // Is the next object (o) greater than the previous (p)?
    (o, p, c, pc, match) => match(o > p.get(0))
  ).then(
    (objs, next) => next(console.log(objs))
  )
);

_.range(9002).forEach((obj) => ffm(obj));
```

#### Sandbox (Matchbox)

FluentFlow supports evaluating string rules in an isolated environment:

```javascript
const _ = require('lodash');
const ffm = require('fluentflow').Matchbox(`
[
  $(
    // Start matching after 9000
    (o, p, c, pc, match) => match(o === 9000)
  ).followedBy(
    // Is the next object (o) greater than the previous (p)?
    (o, p, c, pc, match) => match(o > p.get(0))
  ).then(
    (objs, next) => next(console.log(objs))
  )
]`);
_.range(9002).forEach((obj) => ffm(obj));
```

-   `new Matchbox()` will raise an exception if the chain contains syntax-errors.
-   `ffm()` will run the chain inside a [vm2]-instance.
-   runtime exceptions will be reported via the `ffm()` callback: `ffm(obj, (err) => { console.log(err) } );`

[vm2]: https://github.com/patriksimek/vm2


## Command Line

### Installation

```shell
$ sudo npm install -g fluentflow 
```

### Usage

    Usage: fluentflow.js [OPTIONS] rulesFile

    rulesFile          : path to the rules file
    OPTIONS:
       -j JSONPath     : JSONPath expression
       -t              : test if rules are valid
       -h              : print this help

### Getting started

Configure rules.js:

```javascript
[
  /**
   * Check if somebody forked this repository after submitting an issue.
   * Reverse order because the github api displays events in this order.
   */
  $(
    (o, p, c, pc, match) => {
      match(o.get('type') === 'ForkEvent');
    }
  ).followedBy(
    (o, p, c, pc, match) => match(
        o.get('type') === 'IssuesEvent' &&
        o.get('actor').get('login') === p.get(0).get('actor').get('login')
    )
  ).then((objs, next) => next(
    console.log('User: ' +
      objs.get(1).get('actor').get('login') +
      ' forked after writing issue: ' +
      objs.get(0).get('id')
    )
  ))
];
```

Run FluentFlow:

```shell
$ curl -s https://api.github.com/repos/Enteee/FluentFlow/events | fluentflow rules.js -j '*'
```

_Note:_ `-j '*'` splits an array into objects.


## Testing

```shell
$ npm test
```


## API

[Documentation on github-pages][10]


### ffm

Matching core. Built using the JavaScript API using a [Matcher][11]
or from a [String][12] in a [Matchbox][13].

#### Parameters

-   `obj` **[Object][14]** next [Object][15] to match
-   `cb` **[errorFirstCallback][16]?** callback after matching finishes

### Matcher

Generates the matcher ([ffm][17]) for the given [Rule][18](s).

#### Parameters

-   `rule` **...[Rule][19]** Rule(s) to match against.

#### Examples

```javascript
const _ = require('lodash');
const ff = require('fluentflow');
const $ = ff.RuleBuilder;
const ffm = ff.Matcher(
 $(
    (o, p, c, pc, match, f) => match(o == 42)
  ).followedBy(
    (o, p, c, pc, match, f) => match(o == 9000)
  ).then(
    (objs, next) => next(
      console.log(objs)
    )
  )
);
// match some objects
_.range(9001).forEach((obj) => ffm(obj)); // prints [42, 9000]
```

Returns **[ffm][20]** a new matcher

### Matchbox

Generates the isolated matcher ([ffm][17]) for the given [Rule][18](s).

#### Parameters

-   `rulesRaw` **[string][21]** a string of rules
-   `vmoptions` **[Object][14]?** options to [vm2][22]

#### Examples

```javascript
const _ = require('lodash');
const ffm = require('fluentflow').Matchbox(`
 [
   $(
     (o, p, c, pc, match, forget) => match(o == 42)
   ).followedBy(
     (o, p, c, pc, match, forget) => match(o == 9000)
   ).then(
     (objs, next) => next(
       console.log(objs)
     )
   )
 ]
`);
// match some objects
_.range(9001).forEach((obj) => ffm(obj)); // prints [42, 9000]
```

Returns **[ffm][20]** an isolated [ffm][17]

### Callback Types




#### checkerCallback

Checks if an [Object][15] matches.

Type: [Function][23]

##### Parameters

-   `o` **[Object][14]** the object to check
-   `p` **[Object][14]** the previous object
-   `c` **[Object][14]** the matching context
-   `pc` **[Object][14]** the matching context from the previous state
-   `match` **[match][24]** match callback, true if matches false otherwise
-   `forget` **[forget][25]** forget callback, forget all states including objects passed as arguments

#### thenCallback

Called each time a sequence of [Object][15]s matches a [Rule][18] in a [ffm][17]

Type: [Function][23]

##### Parameters

-   `objs` **[Array][26]** the matched objects
-   `next` **[next][27]** end of callback. Continue matching next object
-   `forget` **[forget][25]** forget objects.

#### errorFirstCallback

Standard node.js callback type.

Type: [Function][23]

##### Parameters

-   `Error` **[Object][14]** Truthy if an error occured
-   `data` **...[Object][14]** data

### Helper Classes




#### Rule

##### Parameters

-   `check` **[Function][23]** checker function
-   `next` **[Rule][19]** next rule

##### setThen

###### Parameters

-   `then` **[thenCallback][28]** match callback

#### RuleBuilder

Builds [Rule][18].

##### Parameters

-   `checker` **[checkerCallback][29]** first checker

##### Examples

```javascript
const rule = require('fluentflow').RuleBuilder(
 (o, p, c, pc, match, forget) => match(o === 42)
).followedBy(
 (o, p, c, pc, match, forget) => match(o === 9000)
).then(
 (objs, next) => next(
   console.log(objs)
 )
); // prints [42, 9000]
```

Returns **[RuleBuilder][30]** continue

##### followedBy

Add a new checker.

###### Parameters

-   `checker` **[checkerCallback][29]** next checker

Returns **[RuleBuilder][30]** continue

##### then

Finishes and builds the chain.

###### Parameters

-   `then` **[thenCallback][28]?** run if rule matches

Returns **[Rule][19]** finish

## next

Signal the end of a [thenCallback][31].

## forget

Signal the intent to forget an object. Must be called before [next][32].

### Parameters

-   `obj` **...[Object][14]** the object(s) to forget

## match

Signal the result of a matching operation.

### Parameters

-   `matched` **[Boolean][33]?** true if matched, false otherwise. Default if omitted: false.

[1]: #command-line

[2]: #library

[3]: https://travis-ci.org/Enteee/FluentFlow

[4]: https://img.shields.io/travis/Enteee/FluentFlow.svg

[5]: https://coveralls.io/github/Enteee/FluentFlow

[6]: https://coveralls.io/repos/github/Enteee/FluentFlow/badge.svg

[7]: https://github.com/Flet/semistandard

[8]: https://img.shields.io/badge/code%20style-semistandard-brightgreen.svg?style=flat-square

[9]: https://twitter.com/hashtag/FluentFlow

[10]: https://enteee.github.io/FluentFlow/

[11]: #matcher

[12]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[13]: #matchbox

[14]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[15]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[16]: #errorfirstcallback

[17]: #ffm

[18]: #rule

[19]: #rule

[20]: #ffm

[21]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[22]: https://www.npmjs.com/package/vm2

[23]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[24]: #match

[25]: #forget

[26]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[27]: #next

[28]: #thencallback

[29]: #checkercallback

[30]: #rulebuilder

[31]: #thencallback

[32]: #next

[33]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean
